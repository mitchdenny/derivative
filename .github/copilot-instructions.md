# GitHub Copilot Instructions for Derivative Project

## Project Overview

Derivative is a generative art project that explores the creative potential of AI-assisted algorithmic art. The project creates a visual genealogy of artworks where each piece is generated by AI agents that take previous p5.js sketches and user-provided keywords to create new variations.

**Key Concept**: The name "derivative" is intentional commentary—this is an art piece about how generative AI derives from existing work.

## Architecture

This is a distributed application orchestrated with .NET Aspire (daily builds). Components:

1. **Frontend** *(not yet implemented)* (Client-side JavaScript)
   - d3.js for force-directed graph visualization
   - p5.js for displaying generated art
   - WebSocket connection for live updates
   - No direct code editing by users—only keyword inputs

2. **Rendering Service** *(not yet implemented)* (Python + Playwright)
   - Containerized application
   - Uses headless Chrome to execute p5.js sketches
   - Captures screenshots of rendered art
   - Saves to storage for serving to frontend

3. **AI Agent Service** *(not yet implemented)* (Microsoft Agent Framework)
   - Code generation agent: Creates new p5.js variations from previous sketch + keywords
   - Code analysis agent: Validates generated code for safety and correctness
   - Critical: Must prevent malicious code and ensure design criteria are met

4. **Backend API** *(not yet implemented)*
   - Manages WebSocket connections
   - Implements queuing and rate limiting for AI generation
   - Coordinates service communication

5. **Storage** *(not yet implemented)*
   - Persists generated images
   - Stores artwork metadata and genealogy

## Technology Constraints

- **Aspire**: Using daily builds (version 13.1.0-preview.1.25551.2 or later)
- **Frontend**: Pure JavaScript or React (TBD), d3.js, p5.js (latest)
- **Rendering**: Python, Playwright, headless Chrome
- **AI**: Microsoft Agent Framework (new)
- **Real-time**: WebSockets for graph updates

## Data Model

- Each artwork node has:
  - Exactly ONE parent (incoming edge)
  - Zero or more children (outgoing edges)
  - Associated p5.js code
  - Input keywords (3-5)
  - Generated image
  - Metadata (timestamp, etc.)

## Development Principles

1. **Service Isolation**: Each component should be independently deployable
2. **Security First**: Generated code must be validated before execution
3. **Rate Limiting**: AI generation is expensive—implement proper queuing
4. **Live Updates**: All clients see graph changes in real-time via WebSocket
5. **Aspire Native**: Leverage Aspire features for orchestration, monitoring, and service discovery

## Code Generation Guidelines

### When creating new services:
- Add them to `apphost.cs` with proper dependencies
- Use Aspire service discovery for inter-service communication
- Configure appropriate health checks
- Add distributed tracing

### For AI agent implementation:
- Use Microsoft Agent Framework patterns
- Implement both generation and validation agents
- Ensure agents can work with p5.js code structure
- Validate that generated code is safe and meets criteria

### For frontend work:
- Keep rendering logic server-side
- Use WebSocket for real-time graph updates
- Ensure d3.js graph handles dynamic node addition
- p5.js sketches should be displayable but not editable

### For rendering service:
- Containerize for isolation
- Use Playwright automation patterns
- Ensure screenshots capture the correct element
- Handle timeouts gracefully

## File Structure

```
derivative/
├── apphost.cs                    # Main Aspire orchestration
├── apphost.run.json              # Launch settings
├── services/
│   ├── frontend/                 # JavaScript client
│   ├── rendering/                # Python/Playwright service
│   ├── ai-agents/                # Microsoft Agent Framework
│   └── api/                      # Backend API + WebSockets
├── .github/
│   ├── copilot-instructions.md   # This file
│   └── copilot/
│       └── aspire-cli.md         # Aspire CLI reference
└── docs/                         # Additional documentation
```

## Common Tasks

### Adding a new Aspire service
1. Create the service project
2. Add to `apphost.cs` with `builder.Add...`
3. Configure dependencies and environment variables
4. Test with `aspire run`

### Testing and Launching the Application

**IMPORTANT**: Always use `aspire run` to launch and test the application. Do NOT launch individual services directly (e.g., do not run `npm run dev` for the Vite client). The Aspire orchestrator manages all services together.

```bash
aspire run
```

This command:
- Launches all services defined in `apphost.cs`
- Starts the Aspire Dashboard for monitoring and observability
- Manages service dependencies and configuration
- Provides a unified development experience

### Updating Aspire
```bash
aspire update
```

## Important Notes

- **AI Safety**: Code analysis agent is critical—never skip validation
- **User Constraints**: Users provide keywords only, no direct code access
- **Graph Structure**: Maintain tree structure (single parent per node)
- **Performance**: Queue AI requests; don't block on generation
- **Monitoring**: Use Aspire Dashboard for observability

## Reference Documentation

- [Aspire CLI Guide](.github/copilot/aspire-cli.md)
- [Microsoft Agent Framework](https://microsoft.github.io/autogen/)
- [p5.js Reference](https://p5js.org/reference/)
- [d3.js Force Simulation](https://d3js.org/d3-force)
- [Playwright Python](https://playwright.dev/python/)

## Security Considerations

- Generated code executes in isolated headless browser
- Validate all generated code before execution
- Rate limit to prevent abuse
- Sanitize user keyword inputs
- No direct code editing from frontend

---

When assisting with this project, prioritize understanding the distributed architecture and the creative intent behind the "derivative" concept. Help maintain the balance between AI creativity and safety constraints.
